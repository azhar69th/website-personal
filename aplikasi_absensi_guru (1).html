<html lang="id"><head><script>(function(firebaseConfig, initialAuthToken, appId) {
        window.__firebase_config = firebaseConfig;
        window.__initial_auth_token = initialAuthToken;
        window.__app_id = appId;
            })("\n{\n  \"apiKey\": \"AIzaSyCqyCcs2R2e7AegGjvFAwG98wlamtbHvZY\",\n  \"authDomain\": \"bard-frontend.firebaseapp.com\",\n  \"projectId\": \"bard-frontend\",\n  \"storageBucket\": \"bard-frontend.firebasestorage.app\",\n  \"messagingSenderId\": \"175205271074\",\n  \"appId\": \"1:175205271074:web:2b7bd4d34d33bf38e6ec7b\"\n}\n","eyJhbGciOiJSUzI1NiIsImtpZCI6ImExZWJmY2U1ZjYwZWY5Y2NkMGViNTc3ZmI3ZjkxZGRjODg1MDA0YzAiLCJ0eXAiOiJKV1QifQ.eyJzdWIiOiJmaXJlYmFzZS1hZG1pbnNkay1mYnN2Y0BiYXJkLWZyb250ZW5kLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwiYXVkIjoiaHR0cHM6Ly9pZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb20vZ29vZ2xlLmlkZW50aXR5LmlkZW50aXR5dG9vbGtpdC52MS5JZGVudGl0eVRvb2xraXQiLCJ1aWQiOiIxNDcxODgzNDI3MzU0Nzc4NzIxNiIsImlzcyI6ImZpcmViYXNlLWFkbWluc2RrLWZic3ZjQGJhcmQtZnJvbnRlbmQuaWFtLmdzZXJ2aWNlYWNjb3VudC5jb20iLCJjbGFpbXMiOnsiYXBwSWQiOiJjX2ZhNTJkMTBjMmNhOTcyMjRfYWJzZW5zaV9ndXJ1Lmh0bWwtMzI5In0sImV4cCI6MTc1Njk0NDM2MSwiaWF0IjoxNzU2OTQwNzYxLCJhbGciOiJSUzI1NiJ9.r38sRCanJoFsy0ka6ZlbbJeb-_rJSBRy7cuK-eK87UbyoDTqIEBR5ejRmTmujSTIm32Lzi5WB2vr3fQsA-9QtKsZTFyl3Mg9RgfSq66oRh6TEULuehNI_yXgbb3pnScO-sxx-nDNCWVLR1ocY5JcuSenxz8e8GNVVUrettekrR1vRPtQ3cVgNM3waqsMPBBi_XcQRwA2KZabYmN2PSvhTcLucvpuMG5xDvsV1xRMGg-QWDtrTkk0DZca37Y5rxlQR-XTZ7WNkyRU0z4oMRYcbK_pbg0emqc0ToxUCMiO4NOv74yhf4ia69HCrzUp7weIu6VxWq7iW7F8ocRWcjdXhQ","c_fa52d10c2ca97224_absensi_guru.html-329")</script><script>(function() {
  // Ensure this script is executed only once
  if (window.firebaseAuthBridgeScriptLoaded) {
    return;
  }
  window.firebaseAuthBridgeScriptLoaded = true;

  let nextTokenPromiseId = 0;

  // Stores { resolve, reject } for ongoing token requests
  const pendingTokenPromises = {};

  // Listen for messages from the Host Application
  window.addEventListener('message', function(event) {

    const messageData = event.data;

  if (messageData && messageData.type === 'RESOLVE_NEW_FIREBASE_TOKEN') {
      const { success, token, error, promiseId } = messageData ?? {};
      if (pendingTokenPromises[promiseId]) {
        if (success) {
          pendingTokenPromises[promiseId].resolve(token);
        } else {
          pendingTokenPromises[promiseId].reject(new Error(error || 'Token refresh failed from host.'));
        }
        delete pendingTokenPromises[promiseId];
      }
    }
  });

  // Expose a function for the Generated App to request a new Firebase token
  window.requestNewFirebaseToken = function() {
    const currentPromiseId = nextTokenPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingTokenPromises[currentPromiseId] = { resolve, reject };
    });
    if (window.parent && window.parent !== window) {
      window.parent.postMessage({
        type: 'REQUEST_NEW_FIREBASE_TOKEN',
        promiseId: currentPromiseId
      }, '*');
    } else {
      pendingTokenPromises[currentPromiseId].reject(new Error('No parent window to request token from.'));
      delete pendingTokenPromises[currentPromiseId];
    }
    return promise;
  };
})();</script><script>
let realOriginalGetUserMedia = null;
if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
  realOriginalGetUserMedia = navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);
}

(function() {
  if (navigator.mediaDevices && navigator.mediaDevices.__proto__) {
    try {
      Object.defineProperty(navigator.mediaDevices.__proto__, 'getUserMedia', {
        get: function() {
          return undefined; // Or throw an error
        },
        configurable: false
      });
    } catch (error) {
      console.error("Error defining prototype getter:", error);
    }
  }
})();

(function() {
  const pendingMediaResolvers = {};
  let nextMediaPromiseId = 0;

  function requestMediaPermissions(constraints) {
    const mediaPromiseId = nextMediaPromiseId++;
    const promise = new Promise((resolve, reject) => {
      pendingMediaResolvers[mediaPromiseId] = (granted) => {
        delete pendingMediaResolvers[mediaPromiseId];
        resolve(granted);
      };
    });

    window.parent.postMessage({
      type: 'requestMediaPermission',
      constraints: constraints,
      promiseId: mediaPromiseId,
    }, '*');

    return promise;
  }

  let originalGetUserMedia = realOriginalGetUserMedia;

  function interceptGetUserMedia() {
    if (navigator.mediaDevices) {
      Object.defineProperty(navigator.mediaDevices, 'getUserMedia', {
        value: function(constraints) {
          return requestMediaPermissions(constraints).then((granted) => {
            if (granted) {
              if (originalGetUserMedia) {
                return originalGetUserMedia(constraints);
              } else {
                throw new Error("Original getUserMedia not available.");
              }
            } else {
              throw new DOMException('Permission denied', 'NotAllowedError');
            }
          });
        },
        writable: false,
        configurable: false
      });
    }
  }

  interceptGetUserMedia();

  const observer = new MutationObserver(function(mutationsList, observer) {
    for (const mutation of mutationsList) {
      if (mutation.type === 'reconfigured' && mutation.name === 'getUserMedia' && mutation.object === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'attributes' && mutation.attributeName === 'getUserMedia' && mutation.target === navigator.mediaDevices) {
        interceptGetUserMedia();
      } else if (mutation.type === 'childList' && mutation.addedNodes) {
        mutation.addedNodes.forEach(node => {
          if (node === navigator.mediaDevices) {
            interceptGetUserMedia();
          }
        });
      }
    }
  });

  function interceptSpeechRecognition() {
    if (!window.SpeechRecognition && !window.webkitSpeechRecognition) {
      return;
    }

    const OriginalSpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    const SpeechRecognitionWrapper = function(...args) {
      const recognizer = new OriginalSpeechRecognition(...args);
      const originalStart = recognizer.start.bind(recognizer);

      recognizer.start = function() {
        requestMediaPermissions({ audio: true }).then(granted => {
          if (granted) {
            originalStart();
          } else {
            const errorEvent = new SpeechRecognitionErrorEvent('error');
            errorEvent.error = 'not-allowed'; // This is the standard error for permission denial.
            recognizer.dispatchEvent(errorEvent);
          }
        });
      };

      return recognizer;
    };

    SpeechRecognitionWrapper.prototype = OriginalSpeechRecognition.prototype;
    SpeechRecognitionWrapper.prototype.constructor = SpeechRecognitionWrapper;

    if (window.SpeechRecognition) {
      window.SpeechRecognition = SpeechRecognitionWrapper;
    }
    if (window.webkitSpeechRecognition) {
      window.webkitSpeechRecognition = SpeechRecognitionWrapper;
    }
  }

  interceptSpeechRecognition();

  window.addEventListener('message', function(event) {
    if (event.data) {
      if (event.data.type === 'resolveMediaPermission') {
        const { promiseId, granted } = event.data;
        if (pendingMediaResolvers[promiseId]) {
          pendingMediaResolvers[promiseId](granted);
        }
      }
    }
  });

})();</script><script>((function(modelInformation) {
  const originalFetch = window.fetch;
  // TODO: b/421908508 - Move these out of the script and match all generative AI model calls.
  let googleLlmBaseApiUrls = [
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':streamGenerateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.textModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.imageEditModelName + ':generateContent',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predict',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.videoModelName + ':predictLongRunning',
    'https://generativelanguage.googleapis.com/v1beta/models/' + modelInformation.ttsModelName + ':generateContent',
  ];
  modelInformation.deprecatedTextModelNames.forEach((modelName) => {
    googleLlmBaseApiUrls.push(
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':streamGenerateContent',
      'https://generativelanguage.googleapis.com/v1beta/models/' + modelName + ':generateContent',
    );
  });

  const pendingFetchResolvers = {};
  let nextPromiseId = 0;

  function handleStringInput(input, optionsArgument) {
    const actualUrl = input;
    const fetchCallArgs = [actualUrl, optionsArgument];
    const effectiveOptions = optionsArgument || {};
    const bodyForApiKeyCheck = effectiveOptions.body;
    const bodyForPostMessage = effectiveOptions.body;
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  function handleRequestInput(input, optionsArgument) {
    const actualUrl = input.url;
    const fetchCallArgs = [input, optionsArgument];
    const effectiveOptions = { method: input.method, headers: new Headers(input.headers) };
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (optionsArgument) {
      if (optionsArgument.method) effectiveOptions.method = optionsArgument.method;
      if (optionsArgument.headers) effectiveOptions.headers = new Headers(optionsArgument.headers);
      if ('body' in optionsArgument) {
        bodyForApiKeyCheck = optionsArgument.body;
        bodyForPostMessage = optionsArgument.body;
      } else {
        bodyForApiKeyCheck = undefined;
        bodyForPostMessage = input.body;
      }
    } else {
      bodyForApiKeyCheck = undefined;
      bodyForPostMessage = input.body;
    }
    return { actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage };
  }

  window.fetch = function(input, optionsArgument) {
    let actualUrl;
    let fetchCallArgs;
    let effectiveOptions = {};
    let bodyForApiKeyCheck;
    let bodyForPostMessage;

    if (typeof input === 'string') {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleStringInput(input, optionsArgument));
    } else if (input instanceof Request) {
      ({actualUrl, fetchCallArgs, effectiveOptions, bodyForApiKeyCheck, bodyForPostMessage} = handleRequestInput(input, optionsArgument));
    } else {
      return originalFetch.apply(window, [input, optionsArgument]);
    }

    effectiveOptions.method = effectiveOptions.method || 'GET';
    if (!effectiveOptions.headers) {
      effectiveOptions.headers = new Headers();
    }


    if (typeof actualUrl === 'string' && googleLlmBaseApiUrls.some((url) => actualUrl.startsWith(url))) {
      let apiKeyIsNull = true;

      const regex = new RegExp("models/([^:]+)");
      const modelNameMatch = actualUrl.match(regex);
      const modelName = modelNameMatch ? modelNameMatch[1] : 'unspecified';


      try {
        const urlObject = new URL(actualUrl);  // Use URL object for robust parsing
        const apiKeyParam = urlObject.searchParams.get('key');
        if (apiKeyParam) {
          apiKeyIsNull = false;
        }
      } catch (e) {
        // Continue checks even if URL parsing fails
      }

      if (apiKeyIsNull && effectiveOptions.headers) {
        const h = new Headers(effectiveOptions.headers);
        const apiKeyHeaderValue = h.get('X-API-Key') || h.get('x-api-key');
        if (apiKeyHeaderValue) {
          apiKeyIsNull = false;
          return originalFetch.apply(window, fetchCallArgs);
        }
      }

      if (apiKeyIsNull && effectiveOptions.method && ['POST', 'PUT', 'PATCH'].includes(effectiveOptions.method.toUpperCase()) && typeof bodyForApiKeyCheck === 'string') {
        try {
          const bodyData = JSON.parse(bodyForApiKeyCheck);
          if (bodyData && bodyData.apiKey) {
            apiKeyIsNull = false;
            return originalFetch.apply(window, fetchCallArgs);
          }
        } catch (e) {
          // Ignore JSON parsing errors
        }
      }

      if(apiKeyIsNull) {
        const promiseId = nextPromiseId++;
        const promise = new Promise((resolve) => {
          pendingFetchResolvers[promiseId] = (resolvedResponse) => {
            delete pendingFetchResolvers[promiseId];
            resolve(resolvedResponse);
          };
        });

        let serializedBodyForPostMessage;
        if (typeof bodyForPostMessage === 'string' || bodyForPostMessage == null) {
            serializedBodyForPostMessage = bodyForPostMessage;
        } else if (bodyForPostMessage instanceof ReadableStream) {
            serializedBodyForPostMessage = null;
        } else {
            try {
                serializedBodyForPostMessage = JSON.stringify(bodyForPostMessage);
            } catch (e) {
                serializedBodyForPostMessage = null;
            }
        }

        const messageOptions = {
            method: effectiveOptions.method,
            headers: Object.fromEntries(new Headers(effectiveOptions.headers).entries()),
            body: serializedBodyForPostMessage
        };

        window.parent.postMessage({
          type: 'requestFetch',
          url: actualUrl,
          modelName: modelName,
          options: messageOptions,
          promiseId: promiseId,
        }, '*');

        return promise;
      }
      return originalFetch.apply(window, fetchCallArgs);
    }
    return originalFetch.apply(window, fetchCallArgs);
  };

  window.addEventListener('message', function(event) {
    if (event.data && event.data.type === 'resolveFetch') {
      const { promiseId, response } = event.data;
      if (pendingFetchResolvers[promiseId]) {
        try {
          const reconstructedResponse = new Response(response.body, {
            status: response.status,
            statusText: response.statusText,
            headers: new Headers(response.headers),
          });
          pendingFetchResolvers[promiseId](reconstructedResponse);
        } catch (error) {
          pendingFetchResolvers[promiseId](new Response(null, { status: 500, statusText: "Interceptor Response Reconstruction Error" }));
        }
      }
    }
  });

}))({"textModelName":"gemini-2.5-flash-preview-05-20","imageModelName":"imagen-3.0-generate-002","imageEditModelName":"gemini-2.5-flash-image-preview","videoModelName":"veo-2.0-generate-001","ttsModelName":"gemini-2.5-flash-preview-tts","deprecatedTextModelNames":["gemini-2.0-flash","gemini-2.5-flash-preview-04-17"]})</script><script>(function() {
  const originalConsoleLog = console.log;
  const originalConsoleError = console.error;

    /**
   * Normalizes an error event or a promise rejection reason into a structured error object.
   * @param {*} errorEventOrReason The error object or reason.
   * @return {object} Structured error data { message, name, stack }.
   */
  function getErrorObject(errorEventOrReason) {
    if (errorEventOrReason instanceof Error) {
      return {
        message: errorEventOrReason.message,
        name: errorEventOrReason.name,
        stack: errorEventOrReason.stack,
      };
    }
    // Fallback for non-Error objects.
    try {
      return {
        message: JSON.stringify(errorEventOrReason),
        name: 'UnknownErrorType',
        stack: null,
      };
    } catch (e) {
      return {
        message: String(errorEventOrReason),
        name: 'UnknownErrorTypeNonStringifiable',
        stack: null,
      };
    }
  }

  /**
   * Converts an array of arguments (from log/error) into a single string.
   * Handles Error objects specially to include their message and stack.
   * @param {Array<*>} args - Arguments passed to console methods.
   * @return {string} A string representation of the arguments.
   */
  function stringifyArgs(args) {
    return args
      .map((arg) => {
        if (arg instanceof Error) {
          const {message, stack} = arg;
          return `Error: ${message}${stack ? ('\nStack: ' + stack) : ''}`;
        }
        if (typeof arg === 'object' && arg !== null) {
          try {
            return JSON.stringify(arg);
          } catch (error) {
            return '[Circular Object]';
          }
        } else {
          return String(arg);
        }
      })
      .join(' ');
  }

  console.log = function(...args) {
    const logString = stringifyArgs(args);
    window.parent.postMessage({ type: 'log', message: logString }, '*');
    originalConsoleLog.apply(console, args);
  };

  console.error = function(...args) {
    let errorData;
    if (args.length > 0 && args[0] instanceof Error) {
      const err = args[0];
      // If the first arg is an Error, capture its details.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        ...getErrorObject(err),
        rawArgsString: stringifyArgs(args.slice(1)),
        timestamp: new Date().toISOString(),
      };
    } else {
      // If not an Error object, treat all args as a general error message.
      errorData = {
        type: 'error',
        source: 'CONSOLE_ERROR',
        message: stringifyArgs(args),
        name: 'ConsoleLoggedError',
        stack: null,
        timestamp: new Date().toISOString(),
      };
    }
    window.parent.postMessage(errorData, '*');
    originalConsoleError.apply(console, args);
  };

  // Listen for global unhandled synchronous errors.
  window.addEventListener('error', function(event) {
    const errorDetails = event.error ? getErrorObject(event.error) : {
      message: event.message,
      name: 'GlobalError',
      stack: null,
      filename: event.filename,
      lineno: event.lineno,
      colno: event.colno,
    };

    window.parent.postMessage({
      type: 'error',
      source: 'global',
      ...errorDetails,
      message: errorDetails.message || event.message,
      timestamp: new Date().toISOString(),
    }, '*');
  });

  // Listen for unhandled promise rejections (asynchronous errors).
  window.addEventListener('unhandledrejection', function(event) {
    const errorDetails = getErrorObject(event.reason);

    window.parent.postMessage({
      type: 'error',
      source: 'unhandledrejection',
      ...errorDetails,
      message: errorDetails.message || 'Unhandled Promise Rejection',
      timestamp: new Date().toISOString(),
    }, '*');
  });

})();</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Absensi Digital Guru - SMPN 1 Pangale</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Library untuk Export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js" crossorigin="anonymous"></script>
    <!-- Library untuk Export Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #f8fafc; /* slate-50 */
            font-family: 'Inter', sans-serif;
            background-image: radial-gradient(#e2e8f0 1px, transparent 0);
            background-size: 20px 20px;
        }
        .container {
            max-width: 1300px;
            margin: 0 auto;
        }
        .card {
            background-color: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(226, 232, 240, 0.5); /* slate-200/50 */
            border-radius: 0.75rem; /* 12px */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: all 0.3s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07), 0 4px 6px -4px rgb(0 0 0 / 0.07);
            transform: translateY(-2px);
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.6rem 1.2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            transition: all 0.2s ease;
            cursor: pointer;
            border: none;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }
        .btn-primary {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca; /* indigo-700 */
        }
        .btn-secondary {
            background-color: #0d9488; /* teal-600 */
            color: white;
        }
        .btn-secondary:hover {
            background-color: #0f766e; /* teal-700 */
        }
        .btn-danger {
            background-color: #e11d48; /* rose-600 */
            color: white;
        }
        .btn-danger:hover {
            background-color: #be123c; /* rose-700 */
        }
        #notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #22c55e; /* green-500 */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transform: translateY(200%);
            transition: transform 0.5s ease-in-out;
            z-index: 1000;
        }
        #notification.show {
            transform: translateY(0);
        }
        #notification.error {
            background-color: #e11d48; /* rose-600 */
        }
        /* Custom form styles */
        .form-input, .form-select {
            border: 1px solid #cbd5e1; /* slate-300 */
            background-color: rgba(241, 245, 249, 0.5); /* slate-100/50 */
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            transition: all 0.2s ease;
        }
        .form-input:focus, .form-select:focus {
            --tw-ring-color: #4f46e5;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
        }
    </style>
<style>*, ::before, ::after{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / 0.5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }/* ! tailwindcss v3.4.17 | MIT License | https://tailwindcss.com */*,::after,::before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}::after,::before{--tw-content:''}:host,html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}menu,ol,ul{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}[role=button],button{cursor:pointer}:disabled{cursor:default}audio,canvas,embed,iframe,img,object,svg,video{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]:where(:not([hidden=until-found])){display:none}.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sticky{position:sticky}.top-0{top:0px}.mb-10{margin-bottom:2.5rem}.mb-2{margin-bottom:0.5rem}.mb-4{margin-bottom:1rem}.mr-2{margin-right:0.5rem}.mt-1{margin-top:0.25rem}.mt-2{margin-top:0.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.grid{display:grid}.h-5{height:1.25rem}.max-h-60{max-height:15rem}.max-h-\[25rem\]{max-height:25rem}.w-5{width:1.25rem}.w-full{width:100%}.min-w-full{min-width:100%}.cursor-pointer{cursor:pointer}.grid-cols-1{grid-template-columns:repeat(1, minmax(0, 1fr))}.grid-cols-2{grid-template-columns:repeat(2, minmax(0, 1fr))}.grid-cols-4{grid-template-columns:repeat(4, minmax(0, 1fr))}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-end{align-items:flex-end}.items-center{align-items:center}.justify-between{justify-content:space-between}.gap-2{gap:0.5rem}.gap-3{gap:0.75rem}.gap-4{gap:1rem}.gap-8{gap:2rem}.space-x-2 > :not([hidden]) ~ :not([hidden]){--tw-space-x-reverse:0;margin-right:calc(0.5rem * var(--tw-space-x-reverse));margin-left:calc(0.5rem * calc(1 - var(--tw-space-x-reverse)))}.space-y-3 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(0.75rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(0.75rem * var(--tw-space-y-reverse))}.space-y-4 > :not([hidden]) ~ :not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.overflow-x-auto{overflow-x:auto}.overflow-y-auto{overflow-y:auto}.rounded{border-radius:0.25rem}.rounded-lg{border-radius:0.5rem}.rounded-md{border-radius:0.375rem}.border{border-width:1px}.border-b{border-bottom-width:1px}.border-slate-200{--tw-border-opacity:1;border-color:rgb(226 232 240 / var(--tw-border-opacity, 1))}.border-slate-200\/80{border-color:rgb(226 232 240 / 0.8)}.border-slate-300{--tw-border-opacity:1;border-color:rgb(203 213 225 / var(--tw-border-opacity, 1))}.bg-slate-200{--tw-bg-opacity:1;background-color:rgb(226 232 240 / var(--tw-bg-opacity, 1))}.bg-slate-50\/80{background-color:rgb(248 250 252 / 0.8)}.bg-slate-700{--tw-bg-opacity:1;background-color:rgb(51 65 85 / var(--tw-bg-opacity, 1))}.bg-white\/80{background-color:rgb(255 255 255 / 0.8)}.p-4{padding:1rem}.p-2{padding:0.5rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-2{padding-top:0.5rem;padding-bottom:0.5rem}.py-3{padding-top:0.75rem;padding-bottom:0.75rem}.py-4{padding-top:1rem;padding-bottom:1rem}.pb-3{padding-bottom:0.75rem}.pr-2{padding-right:0.5rem}.pt-2{padding-top:0.5rem}.text-left{text-align:left}.text-center{text-align:center}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:0.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:0.75rem;line-height:1rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-semibold{font-weight:600}.uppercase{text-transform:uppercase}.tracking-tight{letter-spacing:-0.025em}.tracking-wider{letter-spacing:0.05em}.text-indigo-600{--tw-text-opacity:1;color:rgb(79 70 229 / var(--tw-text-opacity, 1))}.text-slate-500{--tw-text-opacity:1;color:rgb(100 116 139 / var(--tw-text-opacity, 1))}.text-slate-600{--tw-text-opacity:1;color:rgb(71 85 105 / var(--tw-text-opacity, 1))}.text-slate-700{--tw-text-opacity:1;color:rgb(51 65 85 / var(--tw-text-opacity, 1))}.text-slate-800{--tw-text-opacity:1;color:rgb(30 41 59 / var(--tw-text-opacity, 1))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity, 1))}.shadow-sm{--tw-shadow:0 1px 2px 0 rgb(0 0 0 / 0.05);--tw-shadow-colored:0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.file\:mr-4::file-selector-button{margin-right:1rem}.file\:rounded-lg::file-selector-button{border-radius:0.5rem}.file\:border-0::file-selector-button{border-width:0px}.file\:bg-indigo-50::file-selector-button{--tw-bg-opacity:1;background-color:rgb(238 242 255 / var(--tw-bg-opacity, 1))}.file\:px-4::file-selector-button{padding-left:1rem;padding-right:1rem}.file\:py-2::file-selector-button{padding-top:0.5rem;padding-bottom:0.5rem}.file\:text-sm::file-selector-button{font-size:0.875rem;line-height:1.25rem}.file\:font-semibold::file-selector-button{font-weight:600}.file\:text-indigo-700::file-selector-button{--tw-text-opacity:1;color:rgb(67 56 202 / var(--tw-text-opacity, 1))}.hover\:bg-slate-100:hover{--tw-bg-opacity:1;background-color:rgb(241 245 249 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-300:hover{--tw-bg-opacity:1;background-color:rgb(203 213 225 / var(--tw-bg-opacity, 1))}.hover\:bg-slate-800:hover{--tw-bg-opacity:1;background-color:rgb(30 41 59 / var(--tw-bg-opacity, 1))}.hover\:file\:bg-indigo-100::file-selector-button:hover{--tw-bg-opacity:1;background-color:rgb(224 231 255 / var(--tw-bg-opacity, 1))}.focus\:ring-indigo-500:focus{--tw-ring-opacity:1;--tw-ring-color:rgb(99 102 241 / var(--tw-ring-opacity, 1))}@media (min-width: 640px){.sm\:p-6{padding:1.5rem}}@media (min-width: 768px){.md\:w-auto{width:auto}.md\:p-8{padding:2rem}.md\:text-4xl{font-size:2.25rem;line-height:2.5rem}}@media (min-width: 1024px){.lg\:col-span-1{grid-column:span 1 / span 1}.lg\:col-span-2{grid-column:span 2 / span 2}.lg\:grid-cols-3{grid-template-columns:repeat(3, minmax(0, 1fr))}}</style></head>
<body class="p-4 sm:p-6 md:p-8">
    <div class="container">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-800 tracking-tight">Sistem Absensi Digital Guru</h1>
            <p class="text-lg text-slate-500 mt-2">SMP Negeri 1 Pangale</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Kolom Kiri: Input & Manajemen -->
            <div class="lg:col-span-1 flex flex-col gap-8">
                
                <!-- Card Manajemen Data Guru -->
                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-4 border-b border-slate-200 pb-3">Manajemen Data Guru</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="importFile" class="block text-sm font-medium text-slate-600 mb-2">Import Data Guru (.xlsx, .csv)</label>
                            <input type="file" id="importFile" accept=".xlsx, .csv" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100 cursor-pointer">
                            <p class="text-xs text-slate-500 mt-1">Format: NIP, Nama, Pangkat, Mapel, Beban Mengajar</p>
                        </div>
                        <button id="importBtn" class="w-full btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                            Proses Import
                        </button>
                        <div class="grid grid-cols-2 gap-3">
                        <button id="shareAppBtn" class="w-full btn bg-slate-700 text-white hover:bg-slate-800">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 112.632-3.001M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            Bagikan
                        </button>
                        <button id="resetDataBtn" class="w-full btn btn-danger">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            Reset Data
                        </button>
                        </div>
                    </div>
                </div>

                 <!-- Card Input Beban Mengajar Bulanan -->
                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-4 border-b border-slate-200 pb-3">Input Beban Kerja Bulanan</h2>
                    <form id="monthlyLoadForm" class="space-y-4">
                        <div>
                            <label for="loadTeacherSelect" class="block text-sm font-medium text-slate-600">Nama Guru</label>
                            <select id="loadTeacherSelect" class="mt-1 block w-full form-select" required=""><option value="">Pilih Guru...</option></select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="loadMonthSelect" class="block text-sm font-medium text-slate-600">Bulan</label>
                                <select id="loadMonthSelect" class="mt-1 block w-full form-select" required="">
                                    <option value="0">Januari</option><option value="1">Februari</option><option value="2">Maret</option><option value="3">April</option><option value="4">Mei</option><option value="5">Juni</option><option value="6">Juli</option><option value="7">Agustus</option><option value="8">September</option><option value="9">Oktober</option><option value="10">November</option><option value="11">Desember</option>
                                </select>
                            </div>
                            <div>
                                <label for="loadYearSelect" class="block text-sm font-medium text-slate-600">Tahun</label>
                                <select id="loadYearSelect" class="mt-1 block w-full form-select" required=""><option value="2026">2026</option><option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option><option value="2022">2022</option><option value="2021">2021</option><option value="2020">2020</option></select>
                            </div>
                        </div>
                        <div>
                            <label for="monthlyLoadInput" class="block text-sm font-medium text-slate-600">Beban Jam Mengajar</label>
                            <input type="number" id="monthlyLoadInput" min="0" placeholder="Contoh: 24" class="mt-1 block w-full form-input" required="">
                        </div>
                        <div class="grid grid-cols-2 gap-3 pt-2">
                            <button type="submit" class="w-full btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg>
                                Simpan
                            </button>
                            <button type="button" id="resetMonthlyLoadFormBtn" class="w-full btn bg-slate-200 text-slate-700 hover:bg-slate-300">Reset</button>
                        </div>
                    </form>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold text-slate-700 mb-2">Data Beban Kerja Tersimpan</h3>
                        <div class="overflow-x-auto max-h-60 border border-slate-200/80 rounded-lg">
                            <table class="min-w-full">
                                <thead class="bg-slate-50/80 sticky top-0">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Guru</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Periode</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Jam</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="monthlyLoadTableBody" class="bg-white/80"><tr><td colspan="4" class="text-center p-4 text-slate-500">Belum ada data.</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Card Pencatatan Kehadiran -->
                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-4 border-b border-slate-200 pb-3">Pencatatan Kehadiran</h2>
                    <form id="attendanceForm" class="space-y-4">
                        <div>
                            <label for="attendanceDate" class="block text-sm font-medium text-slate-600">Tanggal</label>
                            <input type="date" id="attendanceDate" class="mt-1 block w-full form-input" required="">
                        </div>
                        <div>
                            <label for="teacherSelect" class="block text-sm font-medium text-slate-600">Nama Guru</label>
                            <select id="teacherSelect" class="mt-1 block w-full form-select" required=""><option value="">Pilih Guru...</option></select>
                        </div>
                        <div>
                            <label for="subject" class="block text-sm font-medium text-slate-600">Mata Pelajaran</label>
                            <input type="text" id="subject" placeholder="Contoh: Matematika" class="mt-1 block w-full form-input" required="">
                        </div>
                         <div>
                            <label for="classSelect" class="block text-sm font-medium text-slate-600">Kelas</label>
                            <select id="classSelect" class="mt-1 block w-full form-select" required="">
                                <option value="VII-1">VII-1</option>
                                <option value="VII-2">VII-2</option>
                                <option value="VIII-1">VIII-1</option>
                                <option value="VIII-2">VIII-2</option>
                                <option value="IX-1">IX-1</option>
                                <option value="IX-2">IX-2</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-600">Jam Mengajar</label>
                            <div id="teachingHours" class="mt-2 grid grid-cols-4 gap-2 text-sm text-slate-700">
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="1" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-1</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="2" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-2</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="3" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-3</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="4" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-4</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="5" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-5</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="6" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-6</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="7" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-7</span></label>
                                <label class="flex items-center space-x-2 p-2 rounded-md hover:bg-slate-100 cursor-pointer"><input type="checkbox" name="jam-mengajar" value="8" class="rounded border-slate-300 text-indigo-600 shadow-sm focus:ring-indigo-500"><span>Ke-8</span></label>
                            </div>
                        </div>
                        <div>
                            <label for="statusSelect" class="block text-sm font-medium text-slate-600">Status Kehadiran</label>
                            <select id="statusSelect" class="mt-1 block w-full form-select" required="">
                                <option value="Hadir">Hadir</option>
                                <option value="Izin">Izin</option>
                                <option value="Sakit">Sakit</option>
                                <option value="Alpa">Alpa</option>
                            </select>
                        </div>
                        <div>
                             <label for="description" class="block text-sm font-medium text-slate-600">Keterangan (Opsional)</label>
                             <input type="text" id="description" placeholder="Contoh: Rapat dinas, dll." class="mt-1 block w-full form-input">
                        </div>
                        <div class="grid grid-cols-2 gap-3 pt-2">
                            <button type="submit" class="w-full btn btn-primary">
                                 <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path></svg>
                                 Simpan Absensi
                            </button>
                             <button type="button" id="resetAttendanceFormBtn" class="w-full btn bg-slate-200 text-slate-700 hover:bg-slate-300">Reset</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Kolom Kanan: Daftar Guru dan Laporan -->
            <div class="lg:col-span-2 flex flex-col gap-8">
                <!-- Card Daftar Guru -->
                <div class="card">
                    <h2 class="text-xl font-bold text-slate-700 mb-4 border-b border-slate-200 pb-3">Daftar Guru Terdaftar</h2>
                    <div id="teacherListContainer" class="space-y-3 mt-4 max-h-[25rem] overflow-y-auto pr-2"><p class="text-center py-4 text-slate-500">Belum ada data guru. Silakan import data.</p></div>
                </div>

                <!-- Card Rekapitulasi Kehadiran Bulanan -->
                <div class="card">
                    <div class="flex flex-wrap justify-between items-center mb-4 border-b border-slate-200 pb-3 gap-4">
                        <h2 class="text-xl font-bold text-slate-700">Rekapitulasi Kehadiran</h2>
                        <div class="flex flex-wrap gap-2">
                             <button id="exportExcelBtn" class="btn btn-secondary text-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                                Export Excel
                            </button>
                            <button id="exportPdfBtn" class="btn btn-danger text-sm">
                               <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path></svg>
                                Export PDF
                            </button>
                        </div>
                    </div>
                    <!-- Filter Laporan -->
                    <div class="flex flex-wrap gap-4 items-end mb-4 p-4 bg-slate-50/80 rounded-lg">
                        <div>
                            <label for="filterMonth" class="block text-sm font-medium text-slate-600">Bulan</label>
                            <select id="filterMonth" class="mt-1 block w-full md:w-auto form-select">
                                <option value="all">Semua Bulan</option>
                                <option value="0">Januari</option><option value="1">Februari</option><option value="2">Maret</option><option value="3">April</option><option value="4">Mei</option><option value="5">Juni</option><option value="6">Juli</option><option value="7">Agustus</option><option value="8">September</option><option value="9">Oktober</option><option value="10">November</option><option value="11">Desember</option>
                            </select>
                        </div>
                        <div>
                            <label for="filterYear" class="block text-sm font-medium text-slate-600">Tahun</label>
                            <select id="filterYear" class="mt-1 block w-full md:w-auto form-select"><option value="2026">2026</option><option value="2025">2025</option><option value="2024">2024</option><option value="2023">2023</option><option value="2022">2022</option><option value="2021">2021</option><option value="2020">2020</option></select>
                        </div>
                         <button id="filterBtn" class="btn btn-primary">Terapkan Filter</button>
                         <button type="button" id="resetFilterBtn" class="btn bg-slate-200 text-slate-700 hover:bg-slate-300">Reset</button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-slate-50/80">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nama Guru</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Hadir</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Sakit</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Izin</th>
                                    <th class="px-6 py-3 text-center text-xs font-medium text-slate-500 uppercase tracking-wider">Alpa</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Total Jam</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody" class="bg-white/80"><tr><td colspan="6" class="text-center py-4 text-slate-500">Tidak ada data untuk ditampilkan.</td></tr></tbody>
                        </table>
                    </div>
                </div>

                 <!-- Card Rekapitulasi Beban Kerja -->
                <div class="card">
                    <div class="flex flex-wrap justify-between items-center mb-4 border-b border-slate-200 pb-3 gap-4">
                        <h2 class="text-xl font-bold text-slate-700">Rekapitulasi Beban Kerja</h2>
                         <div class="flex flex-wrap gap-2">
                             <button id="exportRecapExcelBtn" class="btn btn-secondary text-sm">Export Excel</button>
                             <button id="exportRecapPdfBtn" class="btn btn-danger text-sm">Export PDF</button>
                        </div>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-slate-50/80">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Nama Guru</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Target Jam</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Jam Terlaksana</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Persentase</th>
                                </tr>
                            </thead>
                            <tbody id="workloadTableBody" class="bg-white/80"><tr><td colspan="4" class="text-center py-4 text-slate-500">Tidak ada data untuk dihitung.</td></tr></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Elemen Notifikasi -->
    <div id="notification"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // STATE MANAGEMENT
        let teachers = [];
        let attendanceRecords = [];
        let monthlyLoads = [];

        // DOM ELEMENTS
        const importBtn = document.getElementById('importBtn');
        const importFile = document.getElementById('importFile');
        const teacherListContainer = document.getElementById('teacherListContainer');
        const teacherSelect = document.getElementById('teacherSelect');
        const attendanceForm = document.getElementById('attendanceForm');
        const attendanceDate = document.getElementById('attendanceDate');
        const attendanceTableBody = document.getElementById('attendanceTableBody');
        const notification = document.getElementById('notification');
        const filterMonth = document.getElementById('filterMonth');
        const filterYear = document.getElementById('filterYear');
        const filterBtn = document.getElementById('filterBtn');
        const exportExcelBtn = document.getElementById('exportExcelBtn');
        const exportPdfBtn = document.getElementById('exportPdfBtn');
        const workloadTableBody = document.getElementById('workloadTableBody');
        const exportRecapExcelBtn = document.getElementById('exportRecapExcelBtn');
        const exportRecapPdfBtn = document.getElementById('exportRecapPdfBtn');
        const shareAppBtn = document.getElementById('shareAppBtn');
        const monthlyLoadForm = document.getElementById('monthlyLoadForm');
        const loadTeacherSelect = document.getElementById('loadTeacherSelect');
        const loadMonthSelect = document.getElementById('loadMonthSelect');
        const loadYearSelect = document.getElementById('loadYearSelect');
        const monthlyLoadInput = document.getElementById('monthlyLoadInput');
        const monthlyLoadTableBody = document.getElementById('monthlyLoadTableBody');
        const resetDataBtn = document.getElementById('resetDataBtn');
        const resetAttendanceFormBtn = document.getElementById('resetAttendanceFormBtn');
        const resetMonthlyLoadFormBtn = document.getElementById('resetMonthlyLoadFormBtn');
        const resetFilterBtn = document.getElementById('resetFilterBtn');

        // INITIALIZATION
        loadDataFromLocalStorage();
        populateYearFilter(filterYear);
        populateYearFilter(loadYearSelect);
        attendanceDate.valueAsDate = new Date();
        renderTeacherList();
        applyFilter();
        renderMonthlyLoadTable();

        // FUNCTIONS
        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.className = isError ? 'show error' : 'show';
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function saveDataToLocalStorage() {
            localStorage.setItem('teachers', JSON.stringify(teachers));
            localStorage.setItem('attendanceRecords', JSON.stringify(attendanceRecords));
            localStorage.setItem('monthlyLoads', JSON.stringify(monthlyLoads));
        }

        function loadDataFromLocalStorage() {
            teachers = JSON.parse(localStorage.getItem('teachers')) || [];
            attendanceRecords = JSON.parse(localStorage.getItem('attendanceRecords')) || [];
            monthlyLoads = JSON.parse(localStorage.getItem('monthlyLoads')) || [];
        }

        function renderTeacherList() {
            teacherListContainer.innerHTML = '';
            teacherSelect.innerHTML = '<option value="">Pilih Guru...</option>';
            loadTeacherSelect.innerHTML = '<option value="">Pilih Guru...</option>';

            if (teachers.length === 0) {
                teacherListContainer.innerHTML = '<p class="text-center py-4 text-slate-500">Belum ada data guru. Silakan import data.</p>';
                return;
            }

            teachers.sort((a, b) => a.name.localeCompare(b.name));

            teachers.forEach(teacher => {
                const listItem = `
                    <div class="flex justify-between items-center p-3 bg-slate-50/80 rounded-lg border border-slate-200/80 hover:bg-slate-100/80 transition-colors">
                        <div>
                            <p class="font-semibold text-slate-800">${teacher.name}</p>
                            <p class="text-sm text-slate-500">${teacher.nip} | ${teacher.subject || '-'}</p>
                        </div>
                        <button class="text-rose-500 hover:text-rose-700 p-2 rounded-md hover:bg-rose-100 transition-colors delete-teacher-btn" data-nip="${teacher.nip}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        </button>
                    </div>`;
                teacherListContainer.innerHTML += listItem;

                const option = document.createElement('option');
                option.value = teacher.nip;
                option.textContent = teacher.name;
                teacherSelect.appendChild(option.cloneNode(true));
                loadTeacherSelect.appendChild(option);
            });
        }
        
        function renderAttendanceTable(recapData) {
            attendanceTableBody.innerHTML = '';

            if (recapData.length === 0) {
                attendanceTableBody.innerHTML = '<tr><td colspan="6" class="text-center py-4 text-slate-500">Tidak ada data untuk ditampilkan.</td></tr>';
                return;
            }
            
            recapData.sort((a,b) => a.name.localeCompare(b.name));

            recapData.forEach(recap => {
                const row = `
                    <tr class="border-b border-slate-200/80 last:border-0">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${recap.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-slate-700">${recap.Hadir}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-slate-700">${recap.Sakit}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-slate-700">${recap.Izin}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-center text-slate-700">${recap.Alpa}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-indigo-600">${recap.totalHours} Jam</td>
                    </tr>`;
                attendanceTableBody.innerHTML += row;
            });
        }

        function renderMonthlyLoadTable() {
            monthlyLoadTableBody.innerHTML = '';
            if(monthlyLoads.length === 0) {
                monthlyLoadTableBody.innerHTML = '<tr><td colspan="4" class="text-center p-4 text-slate-500">Belum ada data.</td></tr>';
                return;
            }

            monthlyLoads.sort((a,b) => b.year - a.year || b.month - a.month);

            const monthNames = ["Jan", "Feb", "Mar", "Apr", "Mei", "Jun", "Jul", "Agu", "Sep", "Okt", "Nov", "Des"];
            monthlyLoads.forEach(load => {
                const teacher = teachers.find(t => t.nip === load.teacherNip);
                const row = `
                    <tr class="border-b border-slate-200/80 last:border-0">
                        <td class="px-4 py-2 text-sm text-slate-800">${teacher ? teacher.name : 'N/A'}</td>
                        <td class="px-4 py-2 text-sm text-slate-500">${monthNames[load.month]} ${load.year}</td>
                        <td class="px-4 py-2 text-sm text-slate-800 font-semibold">${load.load}</td>
                        <td class="px-4 py-2 text-sm">
                            <button class="text-rose-500 hover:text-rose-700 delete-load-btn" data-id="${load.id}">Hapus</button>
                        </td>
                    </tr>`;
                monthlyLoadTableBody.innerHTML += row;
            });
        }
        
        function populateYearFilter(selectElement) {
            const currentYear = new Date().getFullYear();
            const startYear = currentYear - 5;
            selectElement.innerHTML = '';
            for (let i = currentYear + 1; i >= startYear; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === currentYear) option.selected = true;
                selectElement.appendChild(option);
            }
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                json.shift(); // Remove header
                const newTeachers = json.map(row => ({
                    nip: String(row[0]).trim(),
                    name: String(row[1]).trim(),
                    rank: String(row[2]).trim(),
                    subject: String(row[3] || '').trim(),
                    load: String(row[4] || '0').trim(),
                })).filter(t => t.nip && t.name);
                newTeachers.forEach(newTeacher => {
                    const existingIndex = teachers.findIndex(t => t.nip === newTeacher.nip);
                    if (existingIndex > -1) teachers[existingIndex] = newTeacher;
                    else teachers.push(newTeacher);
                });
                saveDataToLocalStorage();
                renderTeacherList();
                applyFilter();
                showNotification(`Berhasil mengimport ${newTeachers.length} data guru.`);
                importFile.value = '';
            };
            reader.onerror = () => showNotification('Gagal membaca file.', true);
            reader.readAsArrayBuffer(file);
        }

        function handleAttendanceSubmit(event) {
            event.preventDefault();
            const date = attendanceDate.value;
            const teacherNip = teacherSelect.value;
            const subject = document.getElementById('subject').value;
            const className = document.getElementById('classSelect').value;
            const status = document.getElementById('statusSelect').value;
            const description = document.getElementById('description').value;
            const teachingHours = Array.from(document.querySelectorAll('input[name="jam-mengajar"]:checked')).map(cb => cb.value);
            if (!date || !teacherNip || !subject) {
                showNotification('Tanggal, Nama Guru, dan Mata Pelajaran wajib diisi.', true); return;
            }
            if (status === 'Hadir' && teachingHours.length === 0) {
                showNotification('Untuk status Hadir, mohon pilih minimal satu Jam Mengajar.', true); return;
            }
            const newRecord = { id: Date.now().toString(), date, teacherNip, subject, class: className, status, description, teachingHours };
            attendanceRecords.push(newRecord);
            saveDataToLocalStorage();
            applyFilter();
            showNotification('Absensi berhasil disimpan.');
            attendanceForm.reset();
            attendanceDate.valueAsDate = new Date();
        }

        function handleMonthlyLoadSubmit(event) {
            event.preventDefault();
            const teacherNip = loadTeacherSelect.value;
            const month = loadMonthSelect.value;
            const year = loadYearSelect.value;
            const load = monthlyLoadInput.value;
            if(!teacherNip || !load) {
                showNotification('Guru dan Beban Jam wajib diisi.', true); return;
            }
            const id = `${teacherNip}-${year}-${month}`;
            const newLoad = { id, teacherNip, month, year, load };
            const existingIndex = monthlyLoads.findIndex(l => l.id === id);
            if (existingIndex > -1) monthlyLoads[existingIndex] = newLoad;
            else monthlyLoads.push(newLoad);
            saveDataToLocalStorage();
            renderMonthlyLoadTable();
            showNotification('Beban kerja bulanan berhasil disimpan.');
            monthlyLoadForm.reset();
        }

        function handleDeleteTeacher(e) {
            const button = e.target.closest('.delete-teacher-btn');
            if (!button) return;
            const nipToDelete = button.dataset.nip;
            if (confirm(`Yakin hapus guru NIP ${nipToDelete}? Data absensi dan beban kerja terkait akan tetap tersimpan.`)) {
                teachers = teachers.filter(t => t.nip !== nipToDelete);
                saveDataToLocalStorage();
                renderTeacherList();
                applyFilter();
                showNotification('Data guru berhasil dihapus.');
            }
        }

        function handleDeleteMonthlyLoad(e) {
            if (!e.target.classList.contains('delete-load-btn')) return;
            const idToDelete = e.target.dataset.id;
            if(confirm('Yakin hapus data beban kerja ini?')) {
                monthlyLoads = monthlyLoads.filter(l => l.id !== idToDelete);
                saveDataToLocalStorage();
                renderMonthlyLoadTable();
                applyFilter();
                showNotification('Data beban kerja berhasil dihapus.');
            }
        }
        
        function applyFilter() {
            const filteredData = getFilteredData();
            const monthlyRecap = calculateMonthlyAttendanceRecap(filteredData);
            renderAttendanceTable(monthlyRecap);
            calculateAndRenderWorkload();
        }
        
        function getFilteredData() {
            const month = filterMonth.value;
            const year = filterYear.value;
            return attendanceRecords.filter(record => {
                const recordDate = new Date(record.date);
                const yearMatch = recordDate.getFullYear() == year;
                const monthMatch = month === 'all' || recordDate.getMonth() == month;
                return yearMatch && monthMatch;
            });
        }

        function calculateMonthlyAttendanceRecap(filteredRecords) {
            return teachers.map(teacher => {
                const teacherRecords = filteredRecords.filter(r => r.teacherNip === teacher.nip);
                return {
                    name: teacher.name,
                    Hadir: teacherRecords.filter(r => r.status === 'Hadir').length,
                    Sakit: teacherRecords.filter(r => r.status === 'Sakit').length,
                    Izin: teacherRecords.filter(r => r.status === 'Izin').length,
                    Alpa: teacherRecords.filter(r => r.status === 'Alpa').length,
                    totalHours: teacherRecords.reduce((acc, curr) => acc + (curr.teachingHours ? curr.teachingHours.length : 0), 0)
                };
            });
        }
        
        function calculateWorkload() {
            const filteredRecords = getFilteredData();
            const filterMonthValue = filterMonth.value;
            const filterYearValue = filterYear.value;
            return teachers.map(teacher => {
                let targetHours = 0;
                const defaultMonthlyLoad = parseInt(teacher.load) || 0;
                if (filterMonthValue !== 'all') {
                    const monthlyLoad = monthlyLoads.find(l => l.teacherNip === teacher.nip && l.year == filterYearValue && l.month == filterMonthValue);
                    targetHours = monthlyLoad ? parseInt(monthlyLoad.load) : defaultMonthlyLoad;
                } else {
                    let totalYearlyTarget = 0;
                    for (let i = 0; i < 12; i++) {
                        const monthlyLoad = monthlyLoads.find(l => l.teacherNip === teacher.nip && l.year == filterYearValue && l.month == i);
                        totalYearlyTarget += monthlyLoad ? parseInt(monthlyLoad.load) : defaultMonthlyLoad;
                    }
                    targetHours = totalYearlyTarget;
                }
                const actualHours = filteredRecords.filter(r => r.teacherNip === teacher.nip && r.status === 'Hadir').reduce((acc, curr) => acc + (curr.teachingHours ? curr.teachingHours.length : 0), 0);
                const percentage = targetHours > 0 ? ((actualHours / targetHours) * 100).toFixed(1) : 0;
                return { name: teacher.name, target: targetHours, actual: actualHours, percentage: `${percentage}%` };
            });
        }

        function calculateAndRenderWorkload() {
            const workloadData = calculateWorkload();
            workloadTableBody.innerHTML = '';
            if (workloadData.length === 0) {
                 workloadTableBody.innerHTML = '<tr><td colspan="4" class="text-center py-4 text-slate-500">Tidak ada data untuk dihitung.</td></tr>';
                 return;
            }
            workloadData.sort((a,b) => a.name.localeCompare(b.name));
            workloadData.forEach(data => {
                const row = `
                    <tr class="border-b border-slate-200/80 last:border-0">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-900">${data.name}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${data.target} Jam</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-600">${data.actual} Jam</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-indigo-600">${data.percentage}</td>
                    </tr>
                `;
                workloadTableBody.innerHTML += row;
            });
        }

        function handleExportExcel() {
            const recapData = calculateMonthlyAttendanceRecap(getFilteredData());
            if (recapData.length === 0) return showNotification("Tidak ada data untuk diekspor.", true);
            const dataToExport = recapData.map(item => ({ 'Nama Guru': item.name, 'Hadir': item.Hadir, 'Sakit': item.Sakit, 'Izin': item.Izin, 'Alpa': item.Alpa, 'Total Jam Terlaksana': item.totalHours }));
            const worksheet = XLSX.utils.json_to_sheet(dataToExport);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Rekap Kehadiran");
            XLSX.writeFile(workbook, `Rekap_Kehadiran_${filterYear.value}_${filterMonth.options[filterMonth.selectedIndex].text}.xlsx`);
            showNotification("Berhasil mengekspor Rekap Kehadiran.");
        }
        
        function handleExportPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const recapData = calculateMonthlyAttendanceRecap(getFilteredData());
            if (recapData.length === 0) return showNotification("Tidak ada data untuk diekspor.", true);
            const tableColumn = ["Nama Guru", "Hadir", "Sakit", "Izin", "Alpa", "Total Jam"];
            const tableRows = recapData.map(item => [ item.name, item.Hadir, item.Sakit, item.Izin, item.Alpa, `${item.totalHours} Jam` ]);
            const { text: monthText } = filterMonth.options[filterMonth.selectedIndex];
            doc.text(`Rekapitulasi Kehadiran Bulanan - SMPN 1 Pangale`, 14, 15);
            doc.setFontSize(12);
            doc.text(`Periode: ${monthText} ${filterYear.value}`, 14, 22);
            doc.autoTable({ head: [tableColumn], body: tableRows, startY: 30 });
            doc.save(`Rekap_Kehadiran_${filterYear.value}_${monthText}.pdf`);
            showNotification("Berhasil mengekspor Rekap Kehadiran (PDF).");
        }

        function handleExportRecap(type) {
            const workloadData = calculateWorkload();
            if (workloadData.length === 0) return showNotification("Tidak ada data untuk diekspor.", true);
            const selectedMonthValue = filterMonth.value;
            const monthText = selectedMonthValue === 'all' ? 'Januari - Desember' : filterMonth.options[filterMonth.selectedIndex].text;
            const fileNameMonth = selectedMonthValue === 'all' ? 'Tahunan' : filterMonth.options[filterMonth.selectedIndex].text;
            const title = `Rekapitulasi Beban Kerja Guru - ${monthText} ${filterYear.value}`;
            if(type === 'excel') {
                const data = workloadData.map(w => ({ 'Nama Guru': w.name, 'Target Jam': w.target, 'Jam Terlaksana': w.actual, 'Persentase': w.percentage }));
                const worksheet = XLSX.utils.json_to_sheet(data);
                const workbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(workbook, worksheet, "Rekapitulasi");
                XLSX.writeFile(workbook, `Rekap_BebanKerja_${filterYear.value}_${fileNameMonth}.xlsx`);
                showNotification("Berhasil mengekspor rekapitulasi (Excel).");
            } else { // PDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const tableColumn = ['Nama Guru', 'Target Jam', 'Jam Terlaksana', 'Persentase'];
                const tableRows = workloadData.map(w => [w.name, `${w.target} Jam`, `${w.actual} Jam`, w.percentage]);
                doc.text(title, 14, 15);
                doc.autoTable({ head: [tableColumn], body: tableRows, startY: 25 });
                doc.save(`Rekap_BebanKerja_${filterYear.value}_${fileNameMonth}.pdf`);
                showNotification("Berhasil mengekspor rekapitulasi (PDF).");
            }
        }

        function handleShareApp() {
            try {
                const htmlContent = document.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'aplikasi_absensi_guru.html';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showNotification('Aplikasi telah diunduh.');
            } catch (error) {
                console.error('Error sharing app:', error);
                showNotification('Gagal membagikan aplikasi.', true);
            }
        }

        // EVENT LISTENERS
        importBtn.addEventListener('click', () => importFile.click());
        importFile.addEventListener('change', handleFileImport);
        attendanceForm.addEventListener('submit', handleAttendanceSubmit);
        teacherListContainer.addEventListener('click', handleDeleteTeacher);
        filterBtn.addEventListener('click', applyFilter);
        exportExcelBtn.addEventListener('click', handleExportExcel);
        exportPdfBtn.addEventListener('click', handleExportPdf);
        exportRecapExcelBtn.addEventListener('click', () => handleExportRecap('excel'));
        exportRecapPdfBtn.addEventListener('click', () => handleExportRecap('pdf'));
        monthlyLoadForm.addEventListener('submit', handleMonthlyLoadSubmit);
        monthlyLoadTableBody.addEventListener('click', handleDeleteMonthlyLoad);
        shareAppBtn.addEventListener('click', handleShareApp);

        resetDataBtn.addEventListener('click', () => {
            if (confirm('APAKAH ANDA YAKIN? Semua data guru, absensi, dan beban kerja akan dihapus permanen.')) {
                localStorage.clear();
                showNotification('Semua data berhasil direset.');
                setTimeout(() => location.reload(), 1000);
            }
        });

        resetAttendanceFormBtn.addEventListener('click', () => {
            attendanceForm.reset();
            attendanceDate.valueAsDate = new Date();
            document.getElementById('subject').value = '';
        });

        resetMonthlyLoadFormBtn.addEventListener('click', () => {
            monthlyLoadForm.reset();
        });

        resetFilterBtn.addEventListener('click', () => {
            filterMonth.value = 'all';
            filterYear.value = new Date().getFullYear();
            applyFilter();
            showNotification('Filter telah direset.');
        });

        teacherSelect.addEventListener('change', (e) => {
            const selectedNip = e.target.value;
            const subjectInput = document.getElementById('subject');
            if (selectedNip) {
                const teacher = teachers.find(t => t.nip === selectedNip);
                subjectInput.value = (teacher && teacher.subject) ? teacher.subject : '';
            } else {
                subjectInput.value = '';
            }
        });
    });
    </script>




</body></html>